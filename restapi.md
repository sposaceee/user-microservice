# ğŸ“‘ Userâ€‘Service RESTâ€‘API Specification

**Version v1.1 Â· JuneÂ 2025**

| Property         | Value                                |
| ---------------- |--------------------------------------|
| **Service name** | Userâ€‘Service                         |
| **Base URL**     | `http://localhost:4000/users`        |
| **Auth scheme**  | `Authorization: Bearer <accessToken>` |
| **Transport**    | HTTP(JSON)                           |

> All endpoints below require a valid **accessToken** generated by the Authâ€‘Service (see `auth-api-spec.md`).

---
## JWT AUTH FLOW
 
``` mermaid
sequenceDiagram
actor Frontend as Frontend
participant Auth as Auth-Service
participant User as User-Service
participant DB as Postgres

Frontend ->> Auth: POST /auth/register {name, email,password}
Auth ->> DB: INSERT auth_users â€¦
Auth ->> Frontend: 201 {user_id}
Frontend ->> User: POST /user/ {user_id, name, email}
Auth -->> Frontend: 201 {accessToken,refreshToken}
Frontend ->> Auth: POST /auth/login {email,password}
Auth ->> DB: SELECT + bcrypt.compare
Auth -->> Frontend: 200 {accessToken,refreshToken}
Frontend ->> Auth: POST /auth/refresh {refreshToken}
Auth ->> DB: verify + rotate token
Auth -->> Frontend: 200 {accessToken}
Frontend ->> Auth: POST /auth/logout {refreshToken}
Auth ->> DB: delete refresh_token
Auth -->> Frontend: 204



````

## 1Â Endpoints

| Method   | Path        | Query / Body | Success / Response | Error codes                        |
|----------| ----------- |--------------|--------------------|------------------------------------|
| `GET`    | **/health** | â€“            | **200** `"ok"`     | â€“                                  |
| `GET`    | **/**       | `token`      | **200** User info  | `401` Unauthorized  err            |
| `POST`   | **/**       | `token`      | **201**            | `400` Validation \| `409`Eâ€‘Mail exists |
| `PATCH`  | **/**       | `token`      | **204**            | `400` Validation err  etc          |
| `DELETE` | **/**       | `token`      | **204**            | `400` Validation err  etc          |

**PATCH UND DELETE VORÃœBERGEHEND ENTFERNT BIS WIR UNS WEITER GEDANKEN MACHEN WIE DAS FUNKTIONIEREN SOLL**

### 1.1Â User Object

```json
{
  "id": "cea02a2b-e296-4b45-b635-46d344ba827d",
  "name": "username",
  "email": "username@example.com",
  "created_at": "2025-05-26T10:12:34.000Z"
}
```

---

## 2Â Status Codes

| Code | Meaning                                |
| ---- | -------------------------------------- |
| 200  | OK                                     |
| 201  | Created                                |
| 204  | NoÂ Content                             |
| 400  | BadÂ Request (validation / ID format)   |
| 401  | Unauthorized (token missing / invalid) |
| 404  | NotÂ Found                              |
| 409  | Conflict (duplicate eâ€‘mail)            |
| 500  | ServerÂ Error                           |

---

## 3Â JSON Examples

### 3.2Â Create User

```
POST /user
Contentâ€‘Type: application/json
Authorization: Bearer <accessToken>

{
  "name": "username",
  "email": "username@example.com"
}
```

**201 Created** â†’ returns the full User object.

### 3.2Â Get User Info

```
POST /user
Contentâ€‘Type: application/json
Authorization: Bearer <accessToken>

```

**201** â†’ returns the full casted User object .



## 4Â Security Notes

* Every request must include a **valid JWT accessToken** (15Â min TTL).
  Use the Authâ€‘Service `/auth/refresh` endpoint to renew tokens.
* Sanitise `limit`/`offset` inputs to avoid SQL injection.
* Use HTTPS in production and consider adding a global rateâ€‘limiter.

---

â„¹ï¸ This document should evolve together with the implementation â€“ update version & date on each breaking change.
